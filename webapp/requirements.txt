from flask import Flask, request, redirect, url_for, session
import requests, os, string

app = Flask(__name__)
app.secret_key = os.urandom(24)

def load_common_passwords():
    # Load a list of the top 1000 common passwords
    url = 'https://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/Common-Credentials/10-million-password-list-top-1000.txt'
    response = requests.get(url)
    return set(response.text.splitlines())

common_passwords = load_common_passwords()

# Password verification function
def is_password_valid(password):
    # Check password length
    if len(password) < 10:
        return False
    
    # Check if password contains only printing ASCII characters and spaces
    if any(char not in string.printable for char in password):
        return False

    # Check if password is in the list of common passwords
    if password in common_passwords:
        return False
    
    # Encourage longer passwords and passphrases without specific complexity requirements
    return True

@app.route('/', methods=['GET', 'POST'])
def home():
    if request.method == 'POST':
        password = request.form.get('password')
        if is_password_valid(password):
            session['password'] = password
            return redirect(url_for('welcome'))
        else:
            return '''
                <!DOCTYPE html>
                <html>
                <head><title>Home Page</title></head>
                <body>
                    <h1>Login Page</h1>
                    <form method="post">
                        <input type="password" name="password" placeholder="Enter password" required>
                        <button type="submit">Login</button>
                    </form>
                    <p style="color:red;">Password does not meet requirements or is too common.</p>
                </body>
                </html>
            '''
    return '''
        <!DOCTYPE html>
        <html>
        <head><title>Home Page</title></head>
        <body>
            <h1>Login Page</h1>
            <form method="post">
                <input type="password" name="password" placeholder="Enter password" required>
                <button type="submit">Login</button>
            </form>
        </body>
        </html>
    '''

@app.route('/welcome')
def welcome():
    if 'password' not in session:
        return redirect(url_for('home'))
    return f'''
        <!DOCTYPE html>
        <html>
        <head><title>Welcome Page</title></head>
        <body>
            <h1>Welcome</h1>
            <p>Your password is: {session['password']}</p>
            <a href="{url_for('logout')}">Logout</a>
        </body>
        </html>
    '''

@app.route('/logout')
def logout():
    session.pop('password', None)
    return redirect(url_for('home'))

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
